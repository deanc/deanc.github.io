<!doctype html><html><head><meta charset=utf-8><meta name=generator content><title>Bad character encoding causing MySQL errors in PHP
</title><meta property="og:title" content="Bad character encoding causing MySQL errors in PHP"><meta name=description content="Today at work I encountered a peculiar problem when working with some translations. I developed a system whereby we can send out translations to our translators and they&rsquo;ll fill in the blanks and send it back to use which is then imported. Part of this project involved coding a parser for a custom file format to send out to our translators. The benefit of this is it allowed me to validate incoming translation files, as well as easily export them according to the spec I&rsquo;d defined."><meta property="og:description" content="Today at work I encountered a peculiar problem when working with some translations. I developed a system whereby we can send out translations to our translators and they&rsquo;ll fill in the blanks and send it back to use which is then imported. Part of this project involved coding a parser for a custom file format to send out to our translators. The benefit of this is it allowed me to validate incoming translation files, as well as easily export them according to the spec I&rsquo;d defined."><meta property="og:url" content="https://deanclatworthy.com/2011/06/bad-character-encoding-causing-mysql-errors-in-php/"><meta property="og:site_name" content="DeanClatworthy.com"><meta property="og:image" content="https://deanclatworthy.com//img/share.jpg"><meta name=theme-color content="#DE6262"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><link media=all rel=stylesheet href=https://deanclatworthy.com/css/fonts.min.afa67f15066f1a7b3a58de3695ac187abf3d0eeab2d5af15d2006ba2e4576d36.css><link media=all rel=stylesheet href=https://deanclatworthy.com/sass/main.min.c58d6045bb953a6ce98a2707382733e1c826720d60d19749a7ccce1a0c10f6e2.css><link rel=apple-touch-icon sizes=180x180 href=https://deanclatworthy.com//img/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://deanclatworthy.com//img/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://deanclatworthy.com//img/favicons/favicon-16x16.png><link rel=manifest href=https://deanclatworthy.com//img/favicons/site.webmanifest><link rel=mask-icon href=https://deanclatworthy.com//img/favicons/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#000000"><meta name=theme-color content="#ffffff"><link rel=alternate type=application/rss+xml title=RSS href=https://deanclatworthy.com//index.xml></head><body><a id=top></a><main><p class=go-back><a class=button href=/archive.html>&#171; Back to all articles</a></p><h1>Bad character encoding causing MySQL errors in PHP</h1><p class=date>06 June 2011</p><article><p>Today at work I encountered a peculiar problem when working with some translations. I developed a system whereby we can send out translations to our translators and they&rsquo;ll fill in the blanks and send it back to use which is then imported. Part of this project involved coding a parser for a custom file format to send out to our translators. The benefit of this is it allowed me to validate incoming translation files, as well as easily export them according to the spec I&rsquo;d defined.</p><p>We received an Italian translation file and I proceeded to import it until my colleague noticed a few translations were missing. Baffled, I looked into this further and debugged until I spotted some MySQL errors in the logs. The query looked fine, but gave MySQL error number 1366. After a bit of googling I came across users who had received a similar error and had put it down to character encoding issues. It turns out that the translation file had been saved as ISO 8859-1 (Latin-1) rather than UTF-8. It turned out that MySQL was actually refusing to execute the query because the target string I was inserting into a UTF-8 column wasn&rsquo;t valid.</p><p>Rather than go through the complicated process of trying to cast different character sets coming in from various translators I came up with a simple solution which was to open the translation file and check it&rsquo;s contents are strict UTF-8. This is pretty simple to do:</p><div class=highlight><pre tabindex=0 style=color:#3760bf;background-color:#e1e2e7;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#9854f1>if</span>(<span style=color:#587539;font-weight:700>!</span>mb_detect_encoding($str, <span style=color:#587539>&#39;UTF-8&#39;</span>, <span style=color:#9854f1>true</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#9854f1>throw</span> <span style=color:#9854f1>new</span> TranslationException(<span style=color:#587539>&#39;File is invalid UTF-8&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As a quick side note, omit the last parameter if you don&rsquo;t want to be 100% strict.</p></article><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//deanclatworthy.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a><footer><p>&copy; 2024 Dean Clatworthy | <a rel="nofollow noindex" href=#top>Back to top</a></p></footer></main><script async src=/js/form.b721ea0c53adde10805845e816a2dd7821ed44493cf37adb15087e9f75a19f99.js integrity="sha256-tyHqDFOt3hCAWEXoFqLdeCHtREk883rbFQh+n3Whn5k=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-BKE986PPRZ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BKE986PPRZ")</script></body></html>